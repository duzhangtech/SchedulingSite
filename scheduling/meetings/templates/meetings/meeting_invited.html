{%extends "loggedin.html"%}
{% if guest%}
{% block sidebar%}
	<p style="left: 20%; max-width: 50%; position: absolute; top:15%;">You don't have a sidebar because you have not registered</p>
	<a style="position: absolute; left: 20%; top:28%;" href="/">create a sweet account</a>		
{% endblock%}
{% endif %}
{% block content%}
  <h1>{{meeting.name}}</h1>
  <h3>organized by {{meeting.organizer}}</h3>
  <h4>{{meeting.pub_date}}</h4>
  <h4>{{meeting.description}}</h4>
  <h5>{{responded}}</h5>
  <h5>{{othersInvited}}</h5>
  {%for num in data%}
 	<div style="display:none;"id="data_{{forloop.counter}}">{{num}}</div>
  {%endfor%}
  {%for num in specificTimeDispaly%}
 	<div style="display:none;"id="specific_{{forloop.counter}}">{{num}}</div>
  {%endfor%}
<form method="POST" action="respond/">{% csrf_token %}
  {%for num in amountOfAvail%}
	<input style="display:none;"type="checkbox" name="selectedTime" id="dataCarrieravail_{{forloop.counter0}}"value="{{forloop.counter0}}">
  {%endfor%}
  	<input type="submit" id="submitData"value="submit">
</form>
  <div style="display:none;"id="lengthStorage">{{length}}</div>
<div id="scheduleUIwrapperInvite">
<div id='scrollWindow'>
 
  <div id="CalWrapper">
 <div id="clockWrapper">
  {% for time in clock %}
  <h3 id ="clockTime">{{ time }}</h3><br/> 
  {% endfor %}
  </div><!--end of clockWrapper-->
  <div id="container">
  <div id="lines_container"></div>
  <div id="col_1" class="calCol"></div>
  <div id="col_2" class="calCol"></div>
  <div id="col_3" class="calCol"></div>
  <div id="col_4" class="calCol"></div>
  <div id="col_5" class="calCol"></div>
  <div id="col_6" class="calCol"></div>
  <div id="col_7" class="calCol"></div>
  </div>
  </div><!--end of CalWrapper-->
</div>
<div id="dateWrapper">
<a href='#' id='scopeLeft'>last</a>
{% for day in date %}
<h3 class="dateSpacer" id="dateSpacer_{{forloop.counter}}">{{ day }}</h3>
{% endfor %}<!--header-->
{% for day in datesForData %}
<h3 class="datesForData" id="datesForData_{{forloop.counter}}">{{ day|date:"SHORT_DATE_FORMAT" }}</h3>
{% endfor %}<!--header-->
<a href="#" id="scopeRight">next</a>
</div><!--end of dateWrapper-->


</div><!--end of scheduleUIWrapper-->

<!--JQEURY************************************************************************
**********************************************************************************-->
  <script type="text/javascript"> // visualize the Y grid
  var num=2.439024;
  for(var i=0; i<41; i++){  
  var k = num * i;
  $( "#col_1" ).before("<div class='lines' style='top:"+k+"%'></div>" );
  }
 // visualize the X grid
  var num_row=14.2857;
  for(var i=0; i<8; i++){  
  var k = num_row * i;
  var exist=$("#lines_container").html();
  $( "#lines_container" ).html(exist+"<div class='lines_row' style='left:"+k+"%'></div>" );
  }

  // visualize the even o'clock Y grid
  var num=2.439024;
  for(var i=0; i<41; i=i+4){  
  var k = num * i;
  $( "#col_1" ).before("<div class='bold_lines' style='top:"+k+"%'></div>" );
  }

//***********************************window-size********************************
  var GLOBAL = {};
  GLOBAL.userHeight=$(window).height();

//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&7core&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
	var scope = 0; 
    var CalTopY = -GLOBAL.userHeight/28;
    var mouseY;
    var initY;
    var WIDTH = 13.6;
    var counter=0;
    var shortest_height = 2;
    // for inelastic time_slot
    var finalY;
    var gridY = new Array(); 
    var test;  
    var initTopPosition; // carry the top position data from 1st funtion to 2nd
    var message; // carry the message
    var messageTime;
    var messageDate;
  var left_mark = 0;
  var initX = new Array();
//set the default scroll value
$('#scrollWindow').scrollTop( 195 );
for(var i = 0; i < 41; i++){
    gridY[i] = 2.439024 * i; // generate the horizontal grid on the div
}
var parseSeven = function(string){
  var result ='';
  var k = parseInt(string) % 7;
  if(k == 0){
    result = '7';
  }
  else{
    result = k.toString();
  }
  return result;
}
//generate the left attributes of avail_time slots for each one
for(var i=1; i <8;i++){
  left_mark=14.285714*(i-1);
  initX[i] = 0.4+left_mark*0.9999;
};
var data = new Array();
var specific = new Array();
var scopeStorage = new Array();
var length = parseInt($("#lengthStorage").html());
for(var ee =0; ee<length;ee++){
	data[0+3*ee] = $("#data_"+(1+3*ee)+"").html();
	data[1+3*ee] = $("#data_"+(2+3*ee)+"").html();
	data[1+3*ee] = parseInt(data[1+3*ee]) - parseInt(data[0+3*ee]);
    data[2+3*ee] = parseSeven($("#data_"+(3+3*ee)+"").html());
    scopeStorage[ee] = Math.floor(parseInt($("#data_"+(3+3*ee)+"").html())/7);
	specific[0+3*ee] = $("#specific_"+(1+3*ee)+"").html();
	specific[1+3*ee] = $("#specific_"+(2+3*ee)+"").html();
	specific[2+3*ee] = $("#specific_"+(3+3*ee)+"").html();
	var k = ee*3;
$("#container").after("<div class='avail_time scope"+scopeStorage[ee]+"' id='avail_"+ee+"' style='height:"+data[1+3*ee]*2.439024+"%; top: "+gridY[data[0+3*ee]]+"%; left:"+initX[data[2+3*ee]]+"%; position:absolute; width:"+WIDTH+"%; '></div>");

$('#avail_'+ee+'').html("<div class='dataCarrier' id='dataDisplayer_"+ee+"'>"+specific[k+0]+specific[k+1]+specific[k+2]+"</div>");

if(scopeStorage[ee] != 0 ){
  $("#avail_"+ee).hide();
}
};

//scope control
var dateModifier = function(a, b, c){ // a is the two digit string, b is the max date of the month
    var temp = parseInt(a) + c*7 - c*b;
    if ( temp < 0){
      return (temp + b).toString();
    }
    else if( temp > b){
      return temp - b;
    }
    else{
      return temp == 0? b: temp;
    }
};

var modifier = function(string, num){ 
    var dateModified = string.slice(3, 5);
    var date = string.slice(0, 2);
    var k = 0;
    var year = string.slice(-4);
    if(date == '02'){
        if(parseInt(string.slice(-4)) % 4 == 0){ 

            if(num == 1 && parseInt(dateModified) > 22){
                k = 1;
                dateModified = dateModifier(dateModified, 29, num);
            }
            else if(num == -1 && parseInt(dateModified) < 8){
              k = -1;
              dateModified = dateModifier(dateModified, 31, num); 
            }
            else{
        dateModified = dateModifier(dateModified, 30, num); 
          }
        } 
        else{
          if(num == 1 && parseInt(dateModified) > 21){
              k = 1;
              dateModified = dateModifier(dateModified, 28, num);
            }
            else if(num == -1 && parseInt(dateModified) < 8){
              k = -1;
                dateModified = dateModifier(dateModified, 31, num); 
            }
            else{
        dateModified = dateModifier(dateModified, 30, num); 
          }           
        }
    }
    else if(date == '04' || date == '06' || date == '09' || date == '11'){
        if(num==1 && parseInt(dateModified) > 23){
          k = 1;
        dateModified = dateModifier(dateModified, 30, num);
        }
        else if(num == -1 && parseInt(dateModified) < 8){
          k = -1;
        dateModified = dateModifier(dateModified, 31, num);
        }
        else{
        dateModified = dateModifier(dateModified, 30, num); 
        }

    }
    else if(date == '12'){
      if(num == 1 && parseInt(dateModified) > 24){
        k = -11;
        year = (parseInt(year) + 1).toString();
      dateModified = dateModifier(dateModified, 31, num);
      }
      else if(num == -1 && parseInt(dateModified) < 8){
            k = -1;
        dateModified = dateModifier(dateModified, 30, num);     
        }
        else{
        dateModified = dateModifier(dateModified, 31, num); 
        }
      
    }
    else if(date == '01'){
      if(num == 1 && parseInt(dateModified) >24){
        k = 1;
          dateModified = dateModifier(dateModified, 31, num);
      }
      else if(num == -1 && parseInt(dateModified) < 8){
        k = 11;
        year = (parseInt(year) - 1).toString();
          dateModified = dateModifier(dateModified, 31, num);
      }
        else{
        dateModified = dateModifier(dateModified, 31, num); 
        }
    }
    else if(date == '08'){
      if(num == 1 && parseInt(dateModified) >24){
        k = 1;
          dateModified = dateModifier(dateModified, 31, num);
      }
      else if(num == -1 && parseInt(dateModified) < 8){
        k = -1;
        dateModified = dateModifier(dateModified, 31, num);
      }
      else{
        dateModified = dateModifier(dateModified, 31, num); 
        }

    }
    else if(date == '03'){
      if(num == 1 && parseInt(dateModified) >24){
        k = 1;
          dateModified = dateModifier(dateModified, 31, num);
      }
      else if(num == -1 && parseInt(dateModified) < 8){
        if(parseInt(string.slice(-4)) % 4 == 0){ 
      k = -1;
          dateModified = dateModifier(dateModified, 29, num);
          } 
        else{
      k = -1;
          dateModified = dateModifier(dateModified, 28, num);        
          }
      }
        else{
        dateModified = dateModifier(dateModified, 31, num); 
        }
    }        
    else{
        if(num == 1 && parseInt(dateModified) > 24){
          k = 1;
        dateModified = dateModifier(dateModified, 31, num);
        }
        else if(num == -1 && parseInt(dateModified) < 8){
          k = -1;
        dateModified = dateModifier(dateModified, 30, num);
        }
        else{
        dateModified = dateModifier(dateModified, 31, num); 
        }

    }
    dateModified = dateModified.toString();
    if(dateModified.length < 2){
      dateModified = '0'.concat(dateModified);
    }
    date = (parseInt(date) + k).toString();
    if(date.length < 2){
      date = '0'.concat(date);
    }
    return date.concat('/', dateModified, '/', year);
};

var changeDatePositive = function(num){
    var string = $('#datesForData_'+num).html();
    $('#datesForData_'+num).html(modifier(string, 1));
}
var changeDateNegative = function(num){
    var string = $('#datesForData_'+num).html();
    $('#datesForData_'+num).html(modifier(string, -1)); 
}
$('#scopeRight').unbind().click(function(){
  changeDatePositive(1);
  changeDatePositive(2);
  changeDatePositive(3);
  changeDatePositive(4);
  changeDatePositive(5);
  changeDatePositive(6);
  changeDatePositive(7);
  $('.scope'+scope).fadeOut('fast');
  scope = scope + 1;
  $('.scope'+scope).fadeIn('fast');
});
$('#scopeLeft').unbind().click(function(){
  if(scope > 0){
  changeDateNegative(1);
  changeDateNegative(2);
  changeDateNegative(3);
  changeDateNegative(4);
  changeDateNegative(5);
  changeDateNegative(6);
  changeDateNegative(7);
  $('.scope'+scope).fadeOut('fast');
  scope = scope - 1; 
  $('.scope'+scope).fadeIn('fast');
  }
});
//hover effect
$(".avail_time").hover(
	function(){
		$(this).css('background-color','greenyellow');
	}, function(){
		$(this).css('background-color','lawngreen');
	}
);
//click effect + data processing
$('.avail_time').click(function(){
	var number = $(this).attr('id');
	if($("#dataCarrier"+number).attr('checked')==='checked'){
		$("#dataCarrier"+number).attr('checked',false);
		$(this).css('opacity', 0.5);
	}
	else{
		$("#dataCarrier"+number).attr('checked',true);
		$(this).css('opacity',0.9);
	};
});

</script>
{%endblock%}